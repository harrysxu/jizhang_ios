# æµ‹è¯•å¤±è´¥æ’æŸ¥æŒ‡å—

## ğŸ“Œ å¿«é€Ÿæ’æŸ¥æ¸…å•

æ ¹æ®æ‚¨çš„æˆªå›¾ï¼Œæ„å»ºæˆåŠŸä½†æœ‰ 2 ä¸ªè­¦å‘Šã€‚ä»¥ä¸‹æ˜¯å·²ä¿®å¤çš„é—®é¢˜ï¼š

### âœ… å·²ä¿®å¤çš„é—®é¢˜

1. **Info.plist é…ç½®è­¦å‘Š** - å·²æ·»åŠ  `LSSupportsOpeningDocumentsInPlace` é”®
2. **ç‰ˆæœ¬å·ä¸åŒ¹é…è­¦å‘Š** - å·²å°†æ‰€æœ‰ç›®æ ‡çš„ç‰ˆæœ¬å·ç»Ÿä¸€ä¸º `1.0.0`

### ğŸ”„ ä¸‹ä¸€æ­¥æ“ä½œ

1. åœ¨ Xcode ä¸­é‡æ–°æ„å»ºé¡¹ç›®ï¼ˆ`âŒ˜ + B`ï¼‰
2. è¿è¡Œæµ‹è¯•ï¼ˆ`âŒ˜ + U`ï¼‰
3. å¦‚æœè¿˜æœ‰é—®é¢˜ï¼Œç»§ç»­å‚è€ƒä¸‹é¢çš„è¯¦ç»†æ’æŸ¥æŒ‡å—

---

## ä¸€ã€åœ¨ Xcode ä¸­æŸ¥çœ‹æµ‹è¯•å¤±è´¥åŸå› 

### 1. ä½¿ç”¨æµ‹è¯•å¯¼èˆªå™¨ï¼ˆTest Navigatorï¼‰

æœ€ç›´è§‚çš„æ–¹å¼æŸ¥çœ‹æµ‹è¯•å¤±è´¥ï¼š

1. **æ‰“å¼€æµ‹è¯•å¯¼èˆªå™¨**
   - å¿«æ·é”®ï¼š`âŒ˜ + 6`
   - æˆ–ç‚¹å‡»å·¦ä¾§å¯¼èˆªæ çš„è±å½¢å›¾æ ‡

2. **æŸ¥çœ‹å¤±è´¥æµ‹è¯•**
   - âŒ æ ‡è®°è¡¨ç¤ºå¤±è´¥çš„æµ‹è¯•
   - âœ… æ ‡è®°è¡¨ç¤ºæˆåŠŸçš„æµ‹è¯•
   - ç‚¹å‡»å¤±è´¥çš„æµ‹è¯•åç§°ï¼Œå¯ä»¥ç›´æ¥è·³è½¬åˆ°å¤±è´¥çš„ä»£ç ä½ç½®

3. **æŸ¥çœ‹å¤±è´¥è¯¦æƒ…**
   - ç‚¹å‡»å¤±è´¥çš„æµ‹è¯•åï¼Œå³ä¾§ä¼šæ˜¾ç¤ºï¼š
     - å¤±è´¥çš„æ–­è¨€ï¼ˆAssertionï¼‰
     - å®é™…å€¼ vs æœŸæœ›å€¼
     - å¤±è´¥æ—¶çš„å †æ ˆè·Ÿè¸ª

### 2. ä½¿ç”¨æŠ¥å‘Šå¯¼èˆªå™¨ï¼ˆReport Navigatorï¼‰

æŸ¥çœ‹å®Œæ•´çš„æµ‹è¯•æ‰§è¡Œæ—¥å¿—ï¼š

1. **æ‰“å¼€æŠ¥å‘Šå¯¼èˆªå™¨**
   - å¿«æ·é”®ï¼š`âŒ˜ + 9`
   - æˆ–ç‚¹å‡»å·¦ä¾§å¯¼èˆªæ æœ€å³è¾¹çš„æ°”æ³¡å›¾æ ‡

2. **é€‰æ‹©æµ‹è¯•è¿è¡Œè®°å½•**
   - æ‰¾åˆ°æœ€è¿‘çš„ "Test jizhang" è®°å½•
   - ç‚¹å‡»å±•å¼€æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯

3. **æŸ¥çœ‹æ—¥å¿—ä¿¡æ¯**
   - ç‚¹å‡» "Logs" æ ‡ç­¾æŸ¥çœ‹å®Œæ•´æ—¥å¿—
   - åŒ…å«ç¼–è¯‘ã€å¯åŠ¨ã€æ‰§è¡Œçš„æ‰€æœ‰è¾“å‡º
   - å¯ä»¥æœç´¢ç‰¹å®šçš„é”™è¯¯ä¿¡æ¯

### 3. ä½¿ç”¨é—®é¢˜å¯¼èˆªå™¨ï¼ˆIssue Navigatorï¼‰

å¿«é€Ÿå®šä½æ‰€æœ‰é—®é¢˜ï¼š

1. **æ‰“å¼€é—®é¢˜å¯¼èˆªå™¨**
   - å¿«æ·é”®ï¼š`âŒ˜ + 5`
   - æˆ–ç‚¹å‡»å·¦ä¾§å¯¼èˆªæ çš„æ„Ÿå¹å·å›¾æ ‡

2. **æŸ¥çœ‹æµ‹è¯•é—®é¢˜**
   - æ‰€æœ‰æµ‹è¯•å¤±è´¥éƒ½ä¼šåœ¨è¿™é‡Œåˆ—å‡º
   - ç‚¹å‡»å¯ä»¥è·³è½¬åˆ°ç›¸å…³ä»£ç 
   - æ˜¾ç¤ºé”™è¯¯æè¿°å’Œä½ç½®

### 4. åœ¨ä»£ç ç¼–è¾‘å™¨ä¸­æŸ¥çœ‹

è¿è¡Œæµ‹è¯•åï¼Œä»£ç ç¼–è¾‘å™¨ä¸­ä¼šæ˜¾ç¤ºï¼š

- **å¤±è´¥æ ‡è®°**ï¼šæµ‹è¯•æ–¹æ³•å·¦ä¾§ä¼šæ˜¾ç¤º âŒ
- **å†…è”æ¶ˆæ¯**ï¼šå¤±è´¥çš„æ–­è¨€æ—è¾¹ä¼šæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
- **ç‚¹å‡»è±å½¢å›¾æ ‡**ï¼šå¯ä»¥å•ç‹¬è¿è¡Œè¯¥æµ‹è¯•

### 5. æŸ¥çœ‹æµ‹è¯•ç»“æœæ‘˜è¦

æµ‹è¯•è¿è¡Œå®Œæˆåï¼š

1. Xcode ä¼šåœ¨é¡¶éƒ¨æ˜¾ç¤ºä¸€ä¸ªæ¨ªå¹…ï¼Œæ˜¾ç¤ºæµ‹è¯•ç»“æœ
2. ç‚¹å‡»æ¨ªå¹…å¯ä»¥å±•å¼€æŸ¥çœ‹è¯¦ç»†æ‘˜è¦
3. åŒ…å«ï¼š
   - é€šè¿‡çš„æµ‹è¯•æ•°é‡
   - å¤±è´¥çš„æµ‹è¯•æ•°é‡
   - æ€»æ‰§è¡Œæ—¶é—´

## äºŒã€ä½¿ç”¨å‘½ä»¤è¡ŒæŸ¥çœ‹æµ‹è¯•ç»“æœ

### 1. è¿è¡Œæµ‹è¯•å¹¶è¾“å‡ºåˆ°æ–‡ä»¶

```bash
cd jizhang
xcodebuild test \
  -scheme jizhang \
  -destination 'platform=iOS Simulator,name=iPhone 17' \
  2>&1 | tee test_output.log
```

### 2. æŸ¥çœ‹æµ‹è¯•ç»“æœ Bundle

Xcode ä¼šç”Ÿæˆè¯¦ç»†çš„æµ‹è¯•ç»“æœåŒ…ï¼š

```bash
# æŸ¥æ‰¾æœ€æ–°çš„æµ‹è¯•ç»“æœ
open /var/folders/.../ResultBundle_*.xcresult
```

### 3. ä½¿ç”¨ xcresulttool è§£æç»“æœ

```bash
# è·å–æµ‹è¯•ç»“æœæ‘˜è¦
xcrun xcresulttool get --format json --path /path/to/result.xcresult

# æŸ¥çœ‹ç‰¹å®šæµ‹è¯•çš„è¯¦ç»†ä¿¡æ¯
xcrun xcresulttool get --format json \
  --path /path/to/result.xcresult \
  --id TEST_ID
```

## ä¸‰ã€å¸¸è§æµ‹è¯•å¤±è´¥åŸå› 

### 1. éƒ¨ç½²ç›®æ ‡ä¸åŒ¹é…

**é”™è¯¯ä¿¡æ¯ï¼š**
```
Cannot test target "jizhangTests" on "iPhone 16": 
iPhone 16's iOS Simulator 18.5 doesn't match jizhangTests's iOS Simulator 26.0 deployment target.
```

**è§£å†³æ–¹æ³•ï¼š**
1. æ‰“å¼€ Xcode
2. é€‰æ‹©é¡¹ç›® â†’ Targetï¼ˆjizhangTests æˆ– jizhangUITestsï¼‰
3. Build Settings â†’ Deployment â†’ iOS Deployment Target
4. ä¿®æ”¹ä¸ºä¸æ¨¡æ‹Ÿå™¨åŒ¹é…çš„ç‰ˆæœ¬ï¼Œæˆ–ä½¿ç”¨åŒ¹é…çš„æ¨¡æ‹Ÿå™¨

### 2. æ¨¡æ‹Ÿå™¨å¯åŠ¨å¤±è´¥

**é”™è¯¯ä¿¡æ¯ï¼š**
```
Simulator device failed to launch com.xxl.jizhangUITests.xctrunner
```

**å¯èƒ½åŸå› ï¼š**
- æ¨¡æ‹Ÿå™¨æŸåæˆ–ä¸å¯ç”¨
- ç£ç›˜ç©ºé—´ä¸è¶³
- Xcode ç¼“å­˜é—®é¢˜
- æ¨¡æ‹Ÿå™¨æƒé™é—®é¢˜

**è§£å†³æ–¹æ³•ï¼š**

#### æ–¹æ³• 1ï¼šé‡ç½®æ¨¡æ‹Ÿå™¨
```bash
# åˆ—å‡ºæ‰€æœ‰æ¨¡æ‹Ÿå™¨
xcrun simctl list devices

# æ“¦é™¤ç‰¹å®šæ¨¡æ‹Ÿå™¨
xcrun simctl erase <DEVICE_UDID>

# æˆ–é‡å¯æ‰€æœ‰æ¨¡æ‹Ÿå™¨
xcrun simctl shutdown all
```

#### æ–¹æ³• 2ï¼šæ¸…ç† Xcode ç¼“å­˜
```bash
# æ¸…ç†æ„å»ºç¼“å­˜
rm -rf ~/Library/Developer/Xcode/DerivedData/*

# æ¸…ç†æ¨¡æ‹Ÿå™¨ç¼“å­˜
xcrun simctl delete unavailable
```

#### æ–¹æ³• 3ï¼šé‡æ–°åˆ›å»ºæ¨¡æ‹Ÿå™¨
1. æ‰“å¼€ Xcode â†’ Window â†’ Devices and Simulators
2. åˆ é™¤æœ‰é—®é¢˜çš„æ¨¡æ‹Ÿå™¨
3. ç‚¹å‡» "+" åˆ›å»ºæ–°çš„æ¨¡æ‹Ÿå™¨

### 3. ä»£ç ç­¾åé—®é¢˜

**è§£å†³æ–¹æ³•ï¼š**
1. Xcode â†’ Preferences â†’ Accounts
2. ç¡®è®¤ Apple ID å·²ç™»å½•
3. æ£€æŸ¥ Signing & Capabilities è®¾ç½®

### 4. CloudKit æƒé™é—®é¢˜

**è§£å†³æ–¹æ³•ï¼š**
1. ç¡®è®¤å·²åœ¨ Apple Developer é…ç½® CloudKit
2. æ£€æŸ¥ Entitlements æ–‡ä»¶é…ç½®
3. åœ¨æµ‹è¯•ç¯å¢ƒä¸­ä½¿ç”¨ Development Container

### 5. æµ‹è¯•æ•°æ®éš”ç¦»é—®é¢˜

å‚è€ƒ `æµ‹è¯•å®ç°æ€»ç»“.md` ä¸­çš„æ•°æ®éš”ç¦»æ–¹æ¡ˆï¼š

```swift
// ä½¿ç”¨æµ‹è¯•ä¸“ç”¨çš„ ModelContainer
let config = ModelConfiguration(isStoredInMemoryOnly: true)
let container = try ModelContainer(
    for: schema,
    configurations: [config]
)
```

## å››ã€è°ƒè¯•æµ‹è¯•çš„æœ€ä½³å®è·µ

### 1. ä½¿ç”¨æ–­ç‚¹è°ƒè¯•

åœ¨æµ‹è¯•ä¸­è®¾ç½®æ–­ç‚¹ï¼š
- åœ¨æµ‹è¯•æ–¹æ³•ä¸­è®¾ç½®æ–­ç‚¹
- è¿è¡Œæµ‹è¯•æ—¶ä¼šåœ¨æ–­ç‚¹å¤„æš‚åœ
- å¯ä»¥æ£€æŸ¥å˜é‡å€¼å’Œç¨‹åºçŠ¶æ€

### 2. ä½¿ç”¨ XCTContext

```swift
XCTContext.runActivity(named: "éªŒè¯äº¤æ˜“åˆ›å»º") { _ in
    // æµ‹è¯•ä»£ç 
}
```

å¥½å¤„ï¼š
- åœ¨æµ‹è¯•æŠ¥å‘Šä¸­æ˜¾ç¤ºä¸ºå­æ­¥éª¤
- å¤±è´¥æ—¶æ›´å®¹æ˜“å®šä½å…·ä½“æ­¥éª¤

### 3. æ·»åŠ è¯¦ç»†çš„å¤±è´¥æ¶ˆæ¯

```swift
XCTAssertEqual(
    transactions.count, 
    1, 
    "åº”è¯¥åˆ›å»ºä¸€ç¬”äº¤æ˜“ï¼Œä½†å®é™…æœ‰ \(transactions.count) ç¬”"
)
```

### 4. ä½¿ç”¨æµ‹è¯•æ—¥å¿—

```swift
print("æµ‹è¯•å¼€å§‹ - å½“å‰ç”¨æˆ·: \(user.name)")
// æµ‹è¯•ä»£ç 
print("æµ‹è¯•å®Œæˆ - äº¤æ˜“æ•°é‡: \(transactions.count)")
```

### 5. è¿è¡Œç‰¹å®šæµ‹è¯•

```bash
# åªè¿è¡Œç‰¹å®šçš„æµ‹è¯•ç±»
xcodebuild test \
  -scheme jizhang \
  -destination 'platform=iOS Simulator,name=iPhone 17' \
  -only-testing:jizhangTests/LedgerIsolationTests

# åªè¿è¡Œç‰¹å®šçš„æµ‹è¯•æ–¹æ³•
xcodebuild test \
  -scheme jizhang \
  -destination 'platform=iOS Simulator,name=iPhone 17' \
  -only-testing:jizhangTests/LedgerIsolationTests/testTransactionIsolation
```

## äº”ã€å½“å‰é¡¹ç›®çš„æµ‹è¯•å¤±è´¥å¤„ç†

æ ¹æ®å½“å‰çš„æµ‹è¯•è¾“å‡ºï¼Œå»ºè®®æŒ‰ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š

### æ­¥éª¤ 1ï¼šæ£€æŸ¥éƒ¨ç½²ç›®æ ‡

```bash
# æŸ¥çœ‹å½“å‰é…ç½®
grep -A 5 "IPHONEOS_DEPLOYMENT_TARGET" jizhang/jizhang.xcodeproj/project.pbxproj
```

### æ­¥éª¤ 2ï¼šé€‰æ‹©åˆé€‚çš„æ¨¡æ‹Ÿå™¨

å¯ç”¨çš„ iOS 26.0.1 æ¨¡æ‹Ÿå™¨ï¼š
- iPhone 17ï¼ˆæ¨èï¼‰
- iPhone 17 Pro
- iPhone 17 Pro Max
- iPhone Air
- å„ç§ iPad å‹å·

### æ­¥éª¤ 3ï¼šåœ¨ Xcode ä¸­è¿è¡Œæµ‹è¯•

1. æ‰“å¼€ Xcode
2. é€‰æ‹© `jizhang` scheme
3. é€‰æ‹©ç›®æ ‡è®¾å¤‡ï¼šiPhone 17 (26.0.1)
4. `âŒ˜ + U` è¿è¡Œæ‰€æœ‰æµ‹è¯•
5. æˆ–è€…åœ¨æµ‹è¯•å¯¼èˆªå™¨ä¸­å³é”®ç‚¹å‡»å•ä¸ªæµ‹è¯•è¿è¡Œ

### æ­¥éª¤ 4ï¼šæŸ¥çœ‹å…·ä½“å¤±è´¥åŸå› 

æµ‹è¯•å¤±è´¥åï¼š
1. æŒ‰ `âŒ˜ + 9` æ‰“å¼€æŠ¥å‘Šå¯¼èˆªå™¨
2. é€‰æ‹©æœ€æ–°çš„æµ‹è¯•è¿è¡Œ
3. å±•å¼€ "Logs" æ ‡ç­¾
4. æœç´¢ "error" æˆ– "failed" å…³é”®è¯
5. æŸ¥çœ‹å…·ä½“çš„é”™è¯¯å †æ ˆå’Œæ¶ˆæ¯

## å…­ã€æµ‹è¯•æ€§èƒ½é—®é¢˜

å¦‚æœæµ‹è¯•è¿è¡Œç¼“æ…¢ï¼š

### 1. æ£€æŸ¥æµ‹è¯•ä¾èµ–

- é¿å…åœ¨æµ‹è¯•ä¸­è¿›è¡Œç½‘ç»œè¯·æ±‚
- ä½¿ç”¨ Mock æ•°æ®ä»£æ›¿çœŸå®æ•°æ®
- ä½¿ç”¨å†…å­˜æ•°æ®åº“è€Œä¸æ˜¯ç£ç›˜æ•°æ®åº“

### 2. å¹¶è¡Œè¿è¡Œæµ‹è¯•

åœ¨ Scheme è®¾ç½®ä¸­ï¼š
1. Edit Scheme â†’ Test
2. å‹¾é€‰ "Execute in parallel"
3. è®¾ç½® "Maximum number of test runners"

### 3. è·³è¿‡æ…¢é€Ÿæµ‹è¯•

```swift
func testSlowOperation() throws {
    try XCTSkipIf(true, "æš‚æ—¶è·³è¿‡æ­¤æ…¢é€Ÿæµ‹è¯•")
    // æµ‹è¯•ä»£ç 
}
```

## ä¸ƒã€ç›¸å…³æ–‡æ¡£

- [æµ‹è¯•å®ç°æ€»ç»“.md](æµ‹è¯•å®ç°æ€»ç»“.md) - è¯¦ç»†çš„æµ‹è¯•å®ç°è¯´æ˜
- [æµ‹è¯•ä½¿ç”¨æŒ‡å—.md](æµ‹è¯•ä½¿ç”¨æŒ‡å—.md) - å¦‚ä½•ç¼–å†™å’Œè¿è¡Œæµ‹è¯•
- [CloudKitä¿®å¤è¯´æ˜_v6.md](CloudKitä¿®å¤è¯´æ˜_v6.md) - CloudKit ç›¸å…³é—®é¢˜

## å…«ã€è·å–å¸®åŠ©

å¦‚æœä»¥ä¸Šæ–¹æ³•éƒ½æ— æ³•è§£å†³é—®é¢˜ï¼š

1. **æ£€æŸ¥ Xcode ç‰ˆæœ¬**
   ```bash
   xcodebuild -version
   ```

2. **æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—**
   ```bash
   log show --predicate 'process == "Simulator"' --last 5m
   ```

3. **é‡å¯ Xcode å’Œæ¨¡æ‹Ÿå™¨**
   - å®Œå…¨é€€å‡º Xcode
   - å…³é—­æ‰€æœ‰æ¨¡æ‹Ÿå™¨
   - é‡æ–°å¯åŠ¨

4. **é‡å¯ Mac**ï¼ˆç»ˆææ–¹æ¡ˆï¼‰
   - æœ‰æ—¶ç³»ç»Ÿå®ˆæŠ¤è¿›ç¨‹ä¼šå‡ºç°é—®é¢˜
   - é‡å¯å¯ä»¥è§£å†³å¤§éƒ¨åˆ†ç³»ç»Ÿçº§é—®é¢˜
