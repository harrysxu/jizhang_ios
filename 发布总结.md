# 📱 简记账 iOS App 发布总结

## ✅ 当前项目状态

根据代码检查，您的项目已经**基本完成测试**，以下是状态总结：

### 已完成的功能 ✅
- ✅ 核心记账功能
- ✅ 账本管理（多账本）
- ✅ 分类和账户管理
- ✅ 预算管理
- ✅ 统计报表
- ✅ iCloud 同步
- ✅ Widget 小组件
- ✅ Siri 快捷指令
- ✅ 订阅系统（StoreKit 2）
- ✅ 测试完成

### 当前配置 ⚙️
- **Bundle ID**: `com.xxl.jizhang`
- **版本号**: 1.0.0
- **构建号**: 1
- **iCloud 容器**: `iCloud.com.xxl.jizhang`
- **App Group**: `group.com.xxl.jizhang`

---

## ⚠️ 发布前必须处理的事项

### 🔴 1. 修改推送通知环境（必须）

**当前问题：** entitlements 中的推送环境是 `development`

**修改方法：**

打开 `jizhang/jizhang/jizhang.entitlements`，修改第6行：

```xml
<!-- 从这个 -->
<key>aps-environment</key>
<string>development</string>

<!-- 改为这个 -->
<key>aps-environment</key>
<string>production</string>
```

**或者在 Xcode 中：**
1. 选择 jizhang target
2. Signing & Capabilities 标签
3. Push Notifications → Environment → 选择 Production

### 🔴 2. 准备 App 图标（必须）

**需要：** 1024x1024 像素的 App 图标

**步骤：**
1. 设计图标（记账、账本主题）
2. 使用 https://www.appicon.co 生成所有尺寸
3. 在 Xcode 中导入到 `Assets.xcassets/AppIcon`

**注意：** 虽然 `docs/app_icon/` 文件夹有图标，但需要在 Xcode 中正确配置。

### 🔴 3. 准备 App 截图（必须）

**必需尺寸和数量：**
| 设备 | 尺寸 | 数量 |
|------|------|------|
| iPhone 16 Pro Max | 1320 x 2868 | 3-10张 |
| iPhone 15 Pro Max | 1290 x 2796 | 3-10张 |
| iPhone 11 Pro Max | 1242 x 2688 | 3-10张 |
| iPhone 8 Plus | 1242 x 2208 | 3-10张 |

**建议截图内容：**
1. 首页（毛玻璃卡片效果）
2. 添加记账界面
3. 统计报表
4. 预算管理
5. 账本管理

### 🔴 4. 准备隐私政策（必须）

**需要：** 一个公开可访问的隐私政策网页

**方法1 - GitHub Pages（免费推荐）：**
1. 创建新仓库（如 `jizhang-privacy`）
2. 添加 index.html（见详细步骤文档）
3. 启用 GitHub Pages
4. 获得 URL：`https://yourusername.github.io/jizhang-privacy/`

**方法2 - Notion（简单）：**
1. 在 Notion 创建隐私政策页面
2. 点击"Share to web"
3. 获得公开链接

### 🔴 5. 配置 App Store Connect（必须）

**步骤：**
1. 访问 https://appstoreconnect.apple.com
2. 创建新 App（Bundle ID: com.xxl.jizhang）
3. 填写 App 信息：
   - 名称：简记账
   - 副标题：简洁优雅的记账工具
   - 分类：财务
   - 隐私政策 URL：（第4步的URL）
4. 上传截图
5. 填写描述和关键词

### 🔴 6. 配置订阅产品（如果有订阅功能）

**在 App Store Connect 中：**

创建订阅群组，添加产品：
- **月度订阅**: `jizhang_monthly` - ¥6/月
- **年度订阅**: `jizhang_yearly` - ¥48/年
- **终身买断**: `jizhang_lifetime` - ¥98（一次性购买，非消耗型）

⚠️ **重要：** Product ID 必须与代码中 `SubscriptionManager.swift` 完全一致！

### 🔴 7. 代码签名和证书（必须）

**在 Xcode 中：**
1. 选择 jizhang target
2. Signing & Capabilities 标签
3. 勾选 "Automatically manage signing"
4. 选择您的 Team（Apple Developer 账号）
5. 确保 Provisioning Profile 生成成功

**检查所有 Targets：**
- jizhang (主应用) ✅
- jizhangWidget (小组件) ✅

---

## 🟡 建议处理的事项

### 🟡 1. 添加 StoreKit 配置文件

**创建方法：**
1. 在 Xcode 中: File → New → File
2. 选择 "StoreKit Configuration File"
3. 命名为 `Products.storekit`
4. 配置订阅产品（与 App Store Connect 一致）

**用途：** 本地测试订阅功能

### 🟡 2. 检查隐私清单文件

✅ **已创建：** `jizhang/jizhang/PrivacyInfo.xcprivacy`

**验证：** 在 Xcode Project Navigator 中确认此文件已添加到项目。

### 🟡 3. 清理调试代码

**建议检查：**
- 删除或注释掉 print() 调试语句
- 检查是否有 TODO/FIXME 标记
- 确保没有测试用的临时代码

---

## 📋 发布流程（按顺序）

### 阶段1: 准备工作（1-2天）
1. ✅ 修改 aps-environment 为 production
2. ✅ 设计并导入 App 图标
3. ✅ 准备所有尺寸的截图
4. ✅ 创建隐私政策页面
5. ✅ 清理调试代码

### 阶段2: App Store Connect 配置（1天）
1. ✅ 登录并创建 App
2. ✅ 填写 App 信息（描述、关键词、分类等）
3. ✅ 上传截图
4. ✅ 配置订阅产品
5. ✅ 填写隐私政策 URL

### 阶段3: 构建和上传（半天）
1. ✅ 在 Xcode 中配置代码签名
2. ✅ Clean Build Folder (⌘+Shift+K)
3. ✅ Archive (Product → Archive)
4. ✅ Distribute App → App Store Connect
5. ✅ 等待构建处理（10-30分钟）

### 阶段4: 提交审核（半天）
1. ✅ 选择构建版本
2. ✅ 填写"此版本中的新功能"
3. ✅ 填写审核说明
4. ✅ 完成问卷（广告、加密、内容权利）
5. ✅ 提交审核

### 阶段5: 等待审核（1-3天）
1. ✅ 监控审核状态
2. ✅ 如被拒绝，修复问题后重新提交
3. ✅ 审核通过后发布

---

## 📝 快速行动清单

**今天就可以做：**
- [ ] 修改 aps-environment 为 production
- [ ] 设计 App 图标
- [ ] 编写隐私政策内容

**本周完成：**
- [ ] 导入 App 图标到 Xcode
- [ ] 在各个模拟器截图
- [ ] 创建隐私政策页面
- [ ] 注册/登录 App Store Connect
- [ ] 创建 App 记录

**下周完成：**
- [ ] 配置订阅产品
- [ ] 填写完整 App 信息
- [ ] Archive 并上传
- [ ] 提交审核

---

## 📖 详细文档位置

我已为您创建了以下详细文档：

1. **`docs/App发布准备清单.md`**
   - 完整的检查清单
   - 所有必需和可选项
   - 详细说明

2. **`docs/App发布详细步骤.md`**
   - 分步操作指南
   - 截图和配置示例
   - 常见问题解答

3. **`jizhang/jizhang/PrivacyInfo.xcprivacy`**
   - iOS 17+ 必需的隐私清单文件
   - 已配置好常用API声明

4. **`scripts/pre_release_check.sh`**
   - 自动检查脚本
   - 运行方法：`./scripts/pre_release_check.sh`

---

## ⏰ 预计时间

**如果全力准备：**
- 最快：1周（基础版本，快速发布）
- 推荐：2周（完整准备，包含截图美化）
- 稳妥：3-4周（包含 TestFlight 内测）

**审核时间：**
- 首次提交：通常 1-3 个工作日审核
- 审核时长：24-48 小时
- 总计：约 2-5 天

---

## ❓ 常见问题

### Q1: 我还没有 Apple Developer 账号怎么办？
**A:** 访问 https://developer.apple.com/programs/enroll/ 注册，年费 $99（个人）或 $299（企业），审核需要 1-2 个工作日。

### Q2: 订阅功能必须配置吗？
**A:** 如果您的代码中实现了订阅功能（SubscriptionManager），则必须在 App Store Connect 中配置对应的产品，否则审核会被拒绝。

### Q3: 我没有设计能力，图标和截图怎么办？
**A:** 
- 图标：可以使用 Canva、Figma 模板，或雇佣设计师（Fiverr、猪八戒）
- 截图：直接在模拟器截图即可，无需美化（但美化会提升下载率）

### Q4: 隐私政策必须要吗？
**A:** 是的，这是 App Store 的硬性要求。可以使用我提供的模板，部署到 GitHub Pages（免费）。

### Q5: 审核被拒绝怎么办？
**A:** 不要担心，很正常。查看拒绝原因，修复问题后重新提交即可。常见原因：崩溃、功能不完整、隐私政策问题。

---

## 🎯 最重要的3件事

如果时间紧迫，优先处理这3项：

1. **修改 aps-environment 为 production**（5分钟）
2. **准备 App 图标**（2-4小时，可外包）
3. **准备截图和隐私政策**（4-8小时）

其他都可以在 App Store Connect 配置时边做边填。

---

## 💬 需要帮助？

如果在发布过程中遇到问题：

1. **查看详细文档：** `docs/App发布详细步骤.md`
2. **Apple 官方支持：** https://developer.apple.com/support/
3. **开发者论坛：** https://developer.apple.com/forums/

---

**准备好了吗？开始发布您的 App 吧！** 🚀

祝您发布顺利！如有任何问题，随时问我。
